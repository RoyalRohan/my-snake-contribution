name: Generate Contribution Snake
on:
  schedule:
    - cron: "0 * * * *"  # Runs every hour
  workflow_dispatch:     # Allows manual runs

jobs:
  generate-snake:
    runs-on: ubuntu-latest
    permissions:
      contents: write    # Required to push to output branch
      
    steps:
      # Step 1: Checkout code
      - uses: actions/checkout@v4

      # Step 2: Generate snake (simplified reliable method)
      - name: Generate Snake
        run: |
          curl -s "https://raw.githubusercontent.com/Platane/snk/output/github-contribution-grid-snake/dark/RoyalRohan.svg" > snake.svg
          echo "Last updated: $(date)" > timestamp.txt

      # Step 3: Verify file was created
      - name: Check File
        run: |
          if [ ! -f "snake.svg" ]; then
            echo "❌ Error: snake.svg not generated!"
            exit 1
          fi
          echo "✅ Snake file created successfully"

      # Step 4: Deploy to output branch
      - uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: output
          folder: .
          clean: false
